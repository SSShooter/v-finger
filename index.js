"use strict";function getLen(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function dot(t,e){return t.x*e.x+t.y*e.y}function getAngle(t,e){var i=getLen(t)*getLen(e);if(0===i)return 0;var s=dot(t,e)/i;return s>1&&(s=1),Math.acos(s)}function cross(t,e){return t.x*e.y-e.x*t.y}function getRotateAngle(t,e){var i=getAngle(t,e);return cross(t,e)>0&&(i*=-1),180*i/Math.PI}var HandlerAdmin=function(t){this.handlers=[],this.el=t};function wrapFunc(t,e){var i=new HandlerAdmin(t);return i.add(e),i}HandlerAdmin.prototype.add=function(t){this.handlers.push(t)},HandlerAdmin.prototype.del=function(t){t||(this.handlers=[]);for(var e=this.handlers.length;e>=0;e--)this.handlers[e]===t&&this.handlers.splice(e,1)},HandlerAdmin.prototype.dispatch=function(){for(var t=0,e=this.handlers.length;t<e;t++){var i=this.handlers[t];"function"==typeof i&&i.apply(this.el,arguments)}};var AlloyFinger=function(t,e){this.element="string"==typeof t?document.querySelector(t):t,this.start=this.start.bind(this),this.move=this.move.bind(this),this.end=this.end.bind(this),this.cancel=this.cancel.bind(this),this.element.addEventListener("touchstart",this.start,!1),this.element.addEventListener("touchmove",this.move,!1),this.element.addEventListener("touchend",this.end,!1),this.element.addEventListener("touchcancel",this.cancel,!1),this.preV={x:null,y:null},this.pinchStartLen=null,this.zoom=1,this.isDoubleTap=!1;var i=function(){};this.rotate=wrapFunc(this.element,e.rotate||i),this.touchStart=wrapFunc(this.element,e.touchStart||i),this.multipointStart=wrapFunc(this.element,e.multipointStart||i),this.multipointEnd=wrapFunc(this.element,e.multipointEnd||i),this.pinch=wrapFunc(this.element,e.pinch||i),this.swipe=wrapFunc(this.element,e.swipe||i),this.tap=wrapFunc(this.element,e.tap||i),this.doubleTap=wrapFunc(this.element,e.doubleTap||i),this.longTap=wrapFunc(this.element,e.longTap||i),this.singleTap=wrapFunc(this.element,e.singleTap||i),this.pressMove=wrapFunc(this.element,e.pressMove||i),this.twoFingerPressMove=wrapFunc(this.element,e.twoFingerPressMove||i),this.touchMove=wrapFunc(this.element,e.touchMove||i),this.touchEnd=wrapFunc(this.element,e.touchEnd||i),this.touchCancel=wrapFunc(this.element,e.touchCancel||i),this._cancelAllHandler=this.cancelAll.bind(this),window.removeEventListener("scroll",this._cancelAllHandler),window.addEventListener("scroll",this._cancelAllHandler),this.delta=null,this.last=null,this.now=null,this.tapTimeout=null,this.singleTapTimeout=null,this.longTapTimeout=null,this.swipeTimeout=null,this.x1=this.x2=this.y1=this.y2=null,this.preTapPosition={x:null,y:null}};AlloyFinger.prototype={start:function(t){if(t.touches){this.now=Date.now(),this.x1=t.touches[0].pageX,this.y1=t.touches[0].pageY,this.delta=this.now-(this.last||this.now),this.touchStart.dispatch(t,this.element),null!==this.preTapPosition.x&&(this.isDoubleTap=this.delta>0&&this.delta<=250&&Math.abs(this.preTapPosition.x-this.x1)<30&&Math.abs(this.preTapPosition.y-this.y1)<30),this.preTapPosition.x=this.x1,this.preTapPosition.y=this.y1,this.last=this.now;var e=this.preV;if(t.touches.length>1){this._cancelLongTap(),this._cancelSingleTap();var i={x:t.touches[1].pageX-this.x1,y:t.touches[1].pageY-this.y1};e.x=i.x,e.y=i.y,this.pinchStartLen=getLen(e),this.multipointStart.dispatch(t,this.element)}this._preventTap=!1,this.notSingleTap=!1,this.longTapTimeout=setTimeout(function(){this.longTap.dispatch(t,this.element),this._preventTap=!0,this.notSingleTap=!0}.bind(this),750)}},move:function(t){if(t.touches){var e=this.preV,i=t.touches.length,s=t.touches[0].pageX,n=t.touches[0].pageY;if(this.isDoubleTap=!1,i>1){var h=t.touches[1].pageX,a=t.touches[1].pageY,o={x:t.touches[1].pageX-s,y:t.touches[1].pageY-n};null!==e.x&&(this.pinchStartLen>0&&(t.zoom=getLen(o)/this.pinchStartLen,this.pinch.dispatch(t,this.element)),t.angle=getRotateAngle(o,e),this.rotate.dispatch(t,this.element)),e.x=o.x,e.y=o.y,null!==this.x2&&null!==this.sx2?(t.deltaX=(s-this.x2+h-this.sx2)/2,t.deltaY=(n-this.y2+a-this.sy2)/2):(t.deltaX=0,t.deltaY=0),this.twoFingerPressMove.dispatch(t,this.element),this.sx2=h,this.sy2=a}else null!==this.x2?(t.deltaX=s-this.x2,t.deltaY=n-this.y2):(t.deltaX=0,t.deltaY=0),this.pressMove.dispatch(t,this.element);this.touchMove.dispatch(t,this.element),this.notSingleTap=!0,this._cancelLongTap(),this.x2=s,this.y2=n,i>1&&t.preventDefault()}},end:function(t){if(t.changedTouches){this._cancelLongTap();var e=this;t.touches.length<2&&(this.multipointEnd.dispatch(t,this.element),this.sx2=this.sy2=null),this.x2&&Math.abs(this.x1-this.x2)>180||this.y2&&Math.abs(this.y1-this.y2)>180?(t.direction=this._swipeDirection(this.x1,this.x2,this.y1,this.y2),this.swipeTimeout=setTimeout(function(){e.swipe.dispatch(t,e.element)},0)):(!this.x2||Math.abs(this.x1-this.x2)<5&&Math.abs(this.y1-this.y2)<5)&&(this.tapTimeout=setTimeout(function(){e._preventTap||e.tap.dispatch(t,e.element),e.isDoubleTap&&(e.doubleTap.dispatch(t,e.element),clearTimeout(e.singleTapTimeout),e.isDoubleTap=!1)},0),e.isDoubleTap||e.notSingleTap||(e.singleTapTimeout=setTimeout(function(){e.singleTap.dispatch(t,e.element)},250))),this.touchEnd.dispatch(t,this.element),this.preV.x=0,this.preV.y=0,this.zoom=1,this.pinchStartLen=null,this.x1=this.x2=this.y1=this.y2=null}},cancelAll:function(){this._preventTap=!0,clearTimeout(this.singleTapTimeout),clearTimeout(this.tapTimeout),clearTimeout(this.longTapTimeout),clearTimeout(this.swipeTimeout)},cancel:function(t){this.cancelAll(),this.touchCancel.dispatch(t,this.element)},_cancelLongTap:function(){clearTimeout(this.longTapTimeout)},_cancelSingleTap:function(){clearTimeout(this.singleTapTimeout)},_swipeDirection:function(t,e,i,s){return Math.abs(t-e)>=Math.abs(i-s)?t-e>0?"Left":"Right":i-s>0?"Up":"Down"},on:function(t,e){this[t]&&this[t].add(e)},off:function(t,e){this[t]&&this[t].del(e)},destroy:function(){return this.singleTapTimeout&&clearTimeout(this.singleTapTimeout),this.tapTimeout&&clearTimeout(this.tapTimeout),this.longTapTimeout&&clearTimeout(this.longTapTimeout),this.swipeTimeout&&clearTimeout(this.swipeTimeout),this.element.removeEventListener("touchstart",this.start),this.element.removeEventListener("touchmove",this.move),this.element.removeEventListener("touchend",this.end),this.element.removeEventListener("touchcancel",this.cancel),this.rotate.del(),this.touchStart.del(),this.multipointStart.del(),this.multipointEnd.del(),this.pinch.del(),this.swipe.del(),this.tap.del(),this.doubleTap.del(),this.longTap.del(),this.singleTap.del(),this.pressMove.del(),this.twoFingerPressMove.del(),this.touchMove.del(),this.touchEnd.del(),this.touchCancel.del(),this.preV=this.pinchStartLen=this.zoom=this.isDoubleTap=this.delta=this.last=this.now=this.tapTimeout=this.singleTapTimeout=this.longTapTimeout=this.swipeTimeout=this.x1=this.x2=this.y1=this.y2=this.preTapPosition=this.rotate=this.touchStart=this.multipointStart=this.multipointEnd=this.pinch=this.swipe=this.tap=this.doubleTap=this.longTap=this.singleTap=this.pressMove=this.touchMove=this.touchEnd=this.touchCancel=this.twoFingerPressMove=null,null}};var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},DEG_TO_RAD=.017453292519943295,Matrix3D=function(t,e,i,s,n,h,a,o,r,l,u,c,p,d,m,T){this.elements=window.Float32Array?new Float32Array(16):[];var f=this.elements;f[0]=void 0!==t?t:1,f[4]=e||0,f[8]=i||0,f[12]=s||0,f[1]=n||0,f[5]=void 0!==h?h:1,f[9]=a||0,f[13]=o||0,f[2]=r||0,f[6]=l||0,f[10]=void 0!==u?u:1,f[14]=c||0,f[3]=p||0,f[7]=d||0,f[11]=m||0,f[15]=void 0!==T?T:1};Matrix3D.prototype={set:function(t,e,i,s,n,h,a,o,r,l,u,c,p,d,m,T){var f=this.elements;return f[0]=t,f[4]=e,f[8]=i,f[12]=s,f[1]=n,f[5]=h,f[9]=a,f[13]=o,f[2]=r,f[6]=l,f[10]=u,f[14]=c,f[3]=p,f[7]=d,f[11]=m,f[15]=T,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},multiplyMatrices:function(t,e){var i=t.elements,s=this.elements,n=i[0],h=i[4],a=i[8],o=i[12],r=i[1],l=i[5],u=i[9],c=i[13],p=i[2],d=i[6],m=i[10],T=i[14],f=i[3],y=i[7],g=i[11],v=i[15],w=e[0],x=e[1],M=e[2],_=e[3],b=e[4],D=e[5],X=e[6],Y=e[7],E=e[8],A=e[9],S=e[10],F=e[11],L=e[12],Z=e[13],P=e[14],O=e[15];return s[0]=n*w+h*b+a*E+o*L,s[4]=n*x+h*D+a*A+o*Z,s[8]=n*M+h*X+a*S+o*P,s[12]=n*_+h*Y+a*F+o*O,s[1]=r*w+l*b+u*E+c*L,s[5]=r*x+l*D+u*A+c*Z,s[9]=r*M+l*X+u*S+c*P,s[13]=r*_+l*Y+u*F+c*O,s[2]=p*w+d*b+m*E+T*L,s[6]=p*x+d*D+m*A+T*Z,s[10]=p*M+d*X+m*S+T*P,s[14]=p*_+d*Y+m*F+T*O,s[3]=f*w+y*b+g*E+v*L,s[7]=f*x+y*D+g*A+v*Z,s[11]=f*M+y*X+g*S+v*P,s[15]=f*_+y*Y+g*F+v*O,this},_rounded:function(t,e){return e=Math.pow(10,e||15),Math.round(t*e)/e},_arrayWrap:function(t){return window.Float32Array?new Float32Array(t):t},appendTransform:function(t,e,i,s,n,h,a,o,r,l,u,c,p,d){var m=a*DEG_TO_RAD,T=this._rounded(Math.cos(m)),f=this._rounded(Math.sin(m)),y=o*DEG_TO_RAD,g=this._rounded(Math.cos(y)),v=this._rounded(Math.sin(y)),w=r*DEG_TO_RAD,x=this._rounded(Math.cos(-1*w)),M=this._rounded(Math.sin(-1*w));return this.multiplyMatrices(this,this._arrayWrap([1,0,0,t,0,T,f,e,0,-f,T,i,0,0,0,1])),this.multiplyMatrices(this,this._arrayWrap([g,0,v,0,0,1,0,0,-v,0,g,0,0,0,0,1])),this.multiplyMatrices(this,this._arrayWrap([x*s,M*n,0,0,-M*s,x*n,0,0,0,0,1*h,0,0,0,0,1])),(l||u)&&this.multiplyMatrices(this,this._arrayWrap([this._rounded(Math.cos(l*DEG_TO_RAD)),this._rounded(Math.sin(l*DEG_TO_RAD)),0,0,-1*this._rounded(Math.sin(u*DEG_TO_RAD)),this._rounded(Math.cos(u*DEG_TO_RAD)),0,0,0,0,1,0,0,0,0,1])),(c||p||d)&&(this.elements[12]-=c*this.elements[0]+p*this.elements[4]+d*this.elements[8],this.elements[13]-=c*this.elements[1]+p*this.elements[5]+d*this.elements[9],this.elements[14]-=c*this.elements[2]+p*this.elements[6]+d*this.elements[10]),this}};var Matrix2D=function(t,e,i,s,n,h){return this.a=null==t?1:t,this.b=e||0,this.c=i||0,this.d=null==s?1:s,this.tx=n||0,this.ty=h||0,this};function observe(t,e,i){for(var s=0,n=e.length;s<n;s++){watch(t,e[s],i)}}function watch(t,e,i){Object.defineProperty(t,e,{get:function(){return this["_"+e]},set:function(t){this["_"+e]=t,i()}})}function isElement(t){return"object"===("undefined"==typeof HTMLElement?"undefined":_typeof(HTMLElement))?t instanceof HTMLElement:t&&"object"===(void 0===t?"undefined":_typeof(t))&&null!==t&&1===t.nodeType&&"string"==typeof t.nodeName}function Transform(t,e){if(!t.___mixCSS3Transform){var i=["translateX","translateY","translateZ","scaleX","scaleY","scaleZ","rotateX","rotateY","rotateZ","skewX","skewY","originX","originY","originZ"],s=isElement(t);e||i.push("perspective"),t.___mixCSS3Transform=!0,observe(t,i,function(){var i=t.matrix3d.identity().appendTransform(t.translateX,t.translateY,t.translateZ,t.scaleX,t.scaleY,t.scaleZ,t.rotateX,t.rotateY,t.rotateZ,t.skewX,t.skewY,t.originX,t.originY,t.originZ),n=(e?"":"perspective("+t.perspective+"px) ")+"matrix3d("+Array.prototype.slice.call(i.elements).join(",")+")";s?t.style.transform=t.style.msTransform=t.style.OTransform=t.style.MozTransform=t.style.webkitTransform=n:t.transform=n}),t.matrix3d=new Matrix3D,e||(t.perspective=500),t.scaleX=t.scaleY=t.scaleZ=1,t.translateX=t.translateY=t.translateZ=t.rotateX=t.rotateY=t.rotateZ=t.skewX=t.skewY=t.originX=t.originY=t.originZ=0}}function _defineProperty(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}Matrix2D.prototype={identity:function(){return this.a=this.d=1,this.b=this.c=this.tx=this.ty=0,this},appendTransform:function(t,e,i,s,n,h,a,o,r){if(n%360)var l=n*DEG_TO_RAD,u=Math.cos(l),c=Math.sin(l);else u=1,c=0;return h||a?(h*=DEG_TO_RAD,a*=DEG_TO_RAD,this.append(Math.cos(a),Math.sin(a),-Math.sin(h),Math.cos(h),t,e),this.append(u*i,c*i,-c*s,u*s,0,0)):this.append(u*i,c*i,-c*s,u*s,t,e),(o||r)&&(this.tx-=o*this.a+r*this.c,this.ty-=o*this.b+r*this.d),this},append:function(t,e,i,s,n,h){var a=this.a,o=this.b,r=this.c,l=this.d;return this.a=t*a+e*r,this.b=t*o+e*l,this.c=i*a+s*r,this.d=i*o+s*l,this.tx=n*a+h*r+this.tx,this.ty=n*o+h*l+this.ty,this},initialize:function(t,e,i,s,n,h){return this.a=t,this.b=e,this.c=i,this.d=s,this.tx=n,this.ty=h,this},setValues:function(t,e,i,s,n,h){return this.a=null==t?1:t,this.b=e||0,this.c=i||0,this.d=null==s?1:s,this.tx=n||0,this.ty=h||0,this},copy:function(t){return this.setValues(t.a,t.b,t.c,t.d,t.tx,t.ty)}},Transform.getMatrix3D=function(t){var e={translateX:0,translateY:0,translateZ:0,rotateX:0,rotateY:0,rotateZ:0,skewX:0,skewY:0,originX:0,originY:0,originZ:0,scaleX:1,scaleY:1,scaleZ:1};for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return(new Matrix3D).identity().appendTransform(e.translateX,e.translateY,e.translateZ,e.scaleX,e.scaleY,e.scaleZ,e.rotateX,e.rotateY,e.rotateZ,e.skewX,e.skewY,e.originX,e.originY,e.originZ).elements},Transform.getMatrix2D=function(t){var e={translateX:0,translateY:0,rotation:0,skewX:0,skewY:0,originX:0,originY:0,scaleX:1,scaleY:1};for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return(new Matrix2D).identity().appendTransform(e.translateX,e.translateY,e.scaleX,e.scaleY,e.rotation,e.skewX,e.skewY,e.originX,e.originY)};var vFingerMK42={install:function(t,e){t.prototype.toJSON=function(){},t.directive("finger-test",{inserted:function(t){console.log("vFingerMK42 added")}}),t.directive("transform",{inserted:function(t){Transform(t)}});var i=new Map;t.directive("finger",{inserted:function(t,e){var s=i.get(t);void 0===s?i.set(t,new AlloyFinger(t,_defineProperty({},e.arg,function(t,i){return e.value(t,i)}))):s.on(e.arg,function(t,i){return e.value(t,i)})}})}};module.exports=vFingerMK42;
